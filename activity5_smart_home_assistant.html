<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Activity 5 — Smart Home Assistant (Vibrant UI)</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
:root{
  --p1:#ff6b6b; /* coral */
  --p2:#ffd93d; /* sunny yellow */
  --p3:#6bf3ff; /* aqua */
  --p4:#7c3aed; /* purple accent (kept) */
  --bg1:linear-gradient(135deg,var(--p1),var(--p2));
  --glass: rgba(255,255,255,0.10);
  --card-bg: rgba(255,255,255,0.04);
  --muted:#233042;
}
html,body,#app{height:100%}
body{ margin:0; font-family:Inter,system-ui,Arial; -webkit-font-smoothing:antialiased; background: radial-gradient(circle at 10% 20%, rgba(255,107,107,0.12), transparent 6%), radial-gradient(circle at 90% 80%, rgba(107,243,255,0.09), transparent 8%), linear-gradient(180deg,#fff7ed 0%, #fff1f3 100%); color:#0b1220 }
#app{ display:flex; gap:20px; padding:22px; height:100vh; box-sizing:border-box }
.card{ flex:1; border-radius:18px; padding:20px; background:linear-gradient(180deg, rgba(255,255,255,0.85), rgba(255,255,255,0.78)); border:1px solid rgba(8,10,15,0.03); box-shadow:0 14px 40px rgba(20,24,40,0.08); display:flex; flex-direction:column }
.side{ width:360px; min-width:260px; border-radius:18px; padding:20px; background:linear-gradient(180deg, rgba(255,255,255,0.95), rgba(255,255,255,0.90)); border:1px solid rgba(8,10,15,0.03); box-shadow:0 18px 60px rgba(20,24,40,0.06); display:flex; flex-direction:column; gap:14px }
.header{ display:flex; justify-content:space-between; align-items:center; margin-bottom:10px }
.logo{ width:56px; height:56px; border-radius:12px; background:var(--bg1); display:flex; align-items:center; justify-content:center; font-weight:800; color:white; box-shadow:0 8px 30px rgba(124,58,237,0.12); font-size:20px }
.brand{ font-size:20px; color:#081226 }
.small{ font-size:13px; color:var(--muted) }
.muted{ color:var(--muted); font-size:13px }
.control{ background:var(--card-bg); border-radius:12px; padding:14px; border:1px solid rgba(8,10,15,0.03) }
.rule{ background: linear-gradient(90deg, rgba(255,107,107,0.06), rgba(255,217,61,0.06)); padding:10px; border-radius:10px; margin-bottom:6px; font-size:13px; color:#081226 }
.trace{ background: rgba(255,255,255,0.92); padding:12px; border-radius:12px; min-height:160px; overflow:auto; border:1px solid rgba(8,10,15,0.03) }
.btn{ background: linear-gradient(90deg,var(--p1),var(--p3)); color:white; padding:10px 14px; border-radius:12px; border:none; cursor:pointer; font-weight:700; box-shadow:0 8px 30px rgba(99,102,241,0.09) }
.btn.ghost{ background:transparent; border:2px dashed rgba(12,18,28,0.06); color:var(--muted); font-weight:700 }
.input, textarea{ background:transparent; border:2px solid rgba(12,18,28,0.04); border-radius:10px; padding:10px; outline:none }
.input:focus, textarea:focus, select:focus{ box-shadow:0 6px 22px rgba(124,58,237,0.10); border-color:rgba(124,58,237,0.45) }
.example-chip{ background:linear-gradient(90deg,var(--p2),var(--p3)); color:#081226; padding:6px 10px; border-radius:999px; font-weight:700; display:inline-block }
.hint{ font-size:12px; color:rgba(8,18,34,0.6) }
.rule-anim{ transition:transform .18s ease, box-shadow .18s ease }
.rule-anim:hover{ transform:translateY(-6px); box-shadow:0 18px 40px rgba(16,24,40,0.06) }
@media (max-width:1000px){ #app{ flex-direction:column } .side{ width:100% } }
</style>
</head>
<body>
<div id="app">
  <main class="card">
    <div class="header">
      <div style="display:flex; gap:14px; align-items:center">
        <div class="logo">SH</div>
        <div>
          <div class="brand">Smart Home Assistant</div>
          <div class="small" style="margin-top:6px">Logic-based decisions — bright, playful & clear</div>
        </div>
      </div>
    </div>

    <div style="display:flex; gap:16px; flex:1; overflow:hidden;">
      <div style="flex:1; display:flex; flex-direction:column; gap:14px; min-width:0">
        <div class="control">
          <div class="muted">Knowledge Base (rules)</div>
          <textarea id="rules" rows="7" class="w-full mt-3 p-3 rounded input" style="color:#081226; resize:vertical">If MotionDetected AND NightTime -> TurnOn_Lights
If Temperature(Room,T) AND T < 18 -> TurnOn_Heater
If TurnOn_Heater -> IncreaseEnergyUsage
If IncreaseEnergyUsage AND EnergyUsageHigh -> Alert_User</textarea>
          <div style="display:flex; gap:8px; margin-top:12px">
            <button id="forward" class="btn">Run Forward</button>
            <button id="backward" class="btn ghost">Run Backward</button>
            <button id="resetRules" class="btn ghost">Reset KB</button>
          </div>
        </div>

        <div class="control">
          <div class="muted">Facts (observations)</div>
          <textarea id="facts" rows="5" class="w-full mt-3 p-3 rounded input" style="color:#081226">MotionDetected
NightTime
Temperature(LivingRoom,16)
EnergyUsageHigh</textarea>
          <div style="display:flex; gap:8px; margin-top:10px; align-items:center">
            <button id="addFact" class="btn ghost">Add Example Fact</button>
            <button id="clearFacts" class="btn ghost">Clear Facts</button>
            <div class="example-chip">Tip: use Temperature(Room,16)</div>
          </div>
        </div>
      </div>

      <div style="width:360px; display:flex; flex-direction:column; gap:12px;">
        <div class="control">
          <div class="muted">Trace & Actions</div>
          <div id="trace" class="trace small muted" style="margin-top:10px">No inferences yet. Use Forward/Backward chaining.</div>
        </div>

        <div class="control">
          <div class="muted">Queries</div>
          <input id="query" class="p-3 rounded input w-full" placeholder="e.g., TurnOn_Heater" />
          <div style="display:flex; gap:8px; margin-top:10px">
            <button id="whyBtn" class="btn" style="flex:1">Why?</button>
            <button id="clearTrace" class="btn ghost">Clear</button>
          </div>
        </div>

        <div class="control" style="text-align:center">
          <div style="font-weight:800; color:#081226">Human-friendly mapping</div>
          <div class="small muted" style="margin-top:8px">Temperature(Room,16) → Temperature(Room,LT18) automatically.</div>
        </div>
      </div>
    </div>

    <footer style="margin-top:12px; display:flex; justify-content:space-between; align-items:center">
      <div class="small muted">Teaching logical inference in home automation</div>
      <div class="small muted">© AI Demos</div>
    </footer>
  </main>

  <aside class="side">
    <div style="display:flex; gap:12px; align-items:center">
      <div class="logo">SH</div>
      <div>
        <div style="font-weight:800; color:#081226">Smart Home</div>
        <div class="small muted">Forward & Backward chaining</div>
      </div>
    </div>

    <div class="control">
      <div class="muted">Run Settings</div>
      <div style="display:flex; gap:8px; margin-top:10px; align-items:center">
        <label class="muted">Mode</label>
        <select id="mode" class="p-2 rounded input" style="flex:1">
          <option>Explain (detailed)</option>
          <option>Concise</option>
        </select>
      </div>
      <div style="display:flex; gap:8px; margin-top:12px">
        <button id="exportKB" class="btn" style="flex:1">Export KB</button>
        <button id="simulate" class="btn ghost">Simulate</button>
      </div>
    </div>

    <div class="control">
      <div style="font-weight:800; color:#081226">Examples</div>
      <div class="small muted" style="margin-top:8px">
        <span class="example-chip">TurnOn_Heater</span>
        <span class="example-chip">Alert_User</span>
        <span class="example-chip">TurnOn_Lights</span>
      </div>
    </div>

    <div class="control" style="text-align:center">
      <div style="font-weight:700; color:#081226">Quick Actions</div>
      <div style="display:flex; gap:8px; margin-top:10px">
        <button id="copyKB" class="btn ghost" style="flex:1">Copy KB</button>
        <button id="loadExample" class="btn" style="flex:1">Load Example</button>
      </div>
    </div>
  </aside>
</div>

<script>
(() => {
  const rulesBox = document.getElementById('rules'), factsBox = document.getElementById('facts'), trace = document.getElementById('trace')
  const forwardBtn = document.getElementById('forward'), backwardBtn = document.getElementById('backward'), whyBtn = document.getElementById('whyBtn')
  const query = document.getElementById('query'), addFact = document.getElementById('addFact'), clearFacts = document.getElementById('clearFacts')
  const resetRules = document.getElementById('resetRules'), clearTrace = document.getElementById('clearTrace'), simulate = document.getElementById('simulate'), exportKB = document.getElementById('exportKB')
  const copyKB = document.getElementById('copyKB'), loadExample = document.getElementById('loadExample')

  function parseRules(text){
    const lines = text.split('\n').map(l=>l.trim()).filter(Boolean)
    const out = []
    for (const l of lines){
      const parts = l.split('->')
      if (parts.length!==2) continue
      let lhs = parts[0].replace(/^If\s*/i,'').trim()
      const antecedents = lhs.split(/AND|,|;/i).map(s=>s.trim()).filter(Boolean)
      out.push({ antecedents, consequent: parts[1].trim() })
    }
    return out
  }

  function preprocessFacts(rawFacts){
    const facts = []
    rawFacts.forEach(f => {
      const m = f.match(/Temperature\(([^,]+),\s*(\d+(?:\.\d+)?)\)/i)
      if (m){
        const room = m[1].trim(), val = parseFloat(m[2])
        if (val < 18) facts.push(`Temperature(${room},LT18)`)
      }
      facts.push(f)
    })
    return facts
  }

  function forwardChain(rules, facts){
    const known = new Set(facts)
    const traceLines = []
    let changed = true
    while (changed){
      changed = false
      for (const r of rules){
        const ants = r.antecedents.map(a => a.replace(/Temperature\(([^,]+),\s*T\)/i, (m,room)=>`Temperature(${room},LT18)`))
        if (known.has(r.consequent)) continue
        if (ants.every(a => known.has(a))){
          known.add(r.consequent)
          traceLines.push({text:`${r.consequent} ← ${ants.join(' AND ')}`, rule:r})
          changed = true
        }
      }
    }
    return { known: Array.from(known), trace: traceLines }
  }

  function backwardChain(rules, facts, goal, visited = new Set()){
    if (facts.includes(goal)) return { success:true, explanation: `${goal} is a known fact` }
    if (visited.has(goal)) return { success:false }
    visited.add(goal)
    const applicable = rules.filter(r => r.consequent === goal)
    for (const r of applicable){
      const parts = []
      let ok = true
      for (const a of r.antecedents){
        const adapted = a.replace(/Temperature\(([^,]+),\s*T\)/i, (m,room)=>`Temperature(${room},LT18)`)
        const res = backwardChain(rules, facts, adapted, visited)
        if (!res.success){ ok = false; break }
        parts.push(res.explanation)
      }
      if (ok) return { success:true, explanation: `${goal} because ${parts.join(' ; ')}` }
    }
    return { success:false }
  }

  forwardBtn.onclick = () => {
    const rules = parseRules(rulesBox.value)
    const facts = preprocessFacts(factsBox.value.split('\n').map(s=>s.trim()).filter(Boolean))
    const res = forwardChain(rules, facts)
    trace.innerHTML = ''
    if (!res.trace.length) trace.innerHTML = '<div class="hint">No actions derived. Try adding facts or rules.</div>'
    res.trace.forEach((t,i) => { const d = document.createElement('div'); d.className='rule rule-anim'; d.style.cursor='pointer'; d.innerText = `Action: ${t.text}`; trace.appendChild(d) })
    const known = document.createElement('div'); known.style.marginTop='12px'; known.style.color='rgba(4,8,14,0.7)'; known.style.fontWeight='700'; known.innerText = 'Known: ' + res.known.join(', ')
    trace.appendChild(known)
  }

  backwardBtn.onclick = () => {
    const rules = parseRules(rulesBox.value)
    const facts = preprocessFacts(factsBox.value.split('\n').map(s=>s.trim()).filter(Boolean))
    const g = prompt('Which action do you want to justify? (e.g., TurnOn_Heater)')
    if (!g) return
    const res = backwardChain(rules, facts, g)
    trace.innerHTML = res.success
      ? `<div style="color:#06b6d4; font-weight:800">Proved ${g}:</div><div style="margin-top:8px">${res.explanation}</div>`
      : `<div style="color:#ff6b6b; font-weight:800">Could not prove ${g}</div>`
  }

  whyBtn.onclick = () => {
    const rules = parseRules(rulesBox.value)
    const facts = preprocessFacts(factsBox.value.split('\n').map(s=>s.trim()).filter(Boolean))
    const g = query.value.trim()
    if (!g) { alert('Enter a query first'); return }
    const res = backwardChain(rules, facts, g)
    trace.innerHTML = res.success
      ? `<div style="color:#06b6d4; font-weight:800">Proved ${g}:</div><div style="margin-top:8px">${res.explanation}</div>`
      : `<div style="color:#ff6b6b; font-weight:800">Could not prove ${g}</div>`
  }

  addFact.onclick = () => {
    const cur = factsBox.value.trim()
    factsBox.value = (cur ? cur + '\n' : '') + 'NewFact'
  }

  clearFacts.onclick = () => factsBox.value = ''
  
  resetRules.onclick = () => {
    rulesBox.value = `If MotionDetected AND NightTime -> TurnOn_Lights
If Temperature(Room,T) AND T < 18 -> TurnOn_Heater
If TurnOn_Heater -> IncreaseEnergyUsage
If IncreaseEnergyUsage AND EnergyUsageHigh -> Alert_User`
  }

  clearTrace.onclick = () => trace.innerHTML = ''

  simulate.onclick = () => {
    forwardBtn.onclick()
    const derived = Array.from(trace.querySelectorAll('.rule')).map(el => el.innerText)
    alert(derived.length ? derived.join('\n') : 'No actions derived')
  }

  exportKB.onclick = () => {
    const data = { rules: rulesBox.value, facts: factsBox.value }
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' })
    const url = URL.createObjectURL(blob)
    const a = document.createElement('a'); a.href = url; a.download = 'smart_home_kb.json'; a.click()
    URL.revokeObjectURL(url)
  }

  copyKB.onclick = () => navigator.clipboard.writeText(rulesBox.value + '\n\n' + factsBox.value).then(()=>alert('KB copied to clipboard'))

  loadExample.onclick = () => {
    resetRules.onclick()
    factsBox.value = `MotionDetected
NightTime
Temperature(LivingRoom,16)
EnergyUsageHigh`
  }
})();
</script>
</body>
</html>
