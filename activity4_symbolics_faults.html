<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Activity 4 — Fault Diagnosis (Vibrant UI)</title>
<style>
  /* Bright & vibrant redesign */
  :root{
    --bg-1: #fff7ed;      /* warm cream */
    --bg-2: linear-gradient(135deg,#fff7ed 0%, #ffe6f0 100%);
    --card:#ffffff;
    --fg:#0f172a;         /* near-black for text */
    --muted:#475569;
    --accent-1:#ff6b6b;   /* coral */
    --accent-2:#ffb86b;   /* warm orange */
    --accent-3:#7c3aed;   /* vibrant purple */
    --glass: rgba(255,255,255,0.6);
    --panel-shadow: 0 8px 30px rgba(12,16,25,0.08);
    --radius:14px;
  }

  html,body{height:100%; margin:0; background:var(--bg-1); color:var(--fg); font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; -webkit-font-smoothing:antialiased;}
  #app{display:flex; height:100vh; box-sizing:border-box; padding:28px; gap:20px; align-items:stretch}

  /* Terminal-like card becomes bright card with soft rounded corners */
  .terminal {
    flex:1;
    background: linear-gradient(180deg, rgba(255,255,255,0.85), rgba(255,250,245,0.85));
    border-radius:var(--radius);
    padding:22px;
    box-sizing:border-box;
    display:flex;
    flex-direction:column;
    gap:16px;
    min-width:320px;
    box-shadow: var(--panel-shadow);
    overflow:hidden;
    border: 1px solid rgba(124,58,237,0.06);
  }

  .title { display:flex; justify-content:space-between; align-items:center; gap:12px; }
  .title h1{ margin:0; font-size:20px; color:var(--accent-3); letter-spacing:0.02em }
  .title .meta{ font-size:13px; color:var(--muted); }

  .console {
    flex:1;
    background: linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,247,240,0.9));
    border-radius:10px;
    padding:14px;
    overflow:auto;
    box-shadow: inset 0 6px 20px rgba(124,58,237,0.02);
    border: 1px solid rgba(124,58,237,0.04);
  }

  .row { display:flex; gap:12px; align-items:flex-start; }
  .col { display:flex; flex-direction:column; gap:10px; }

  .panel {
    background: linear-gradient(180deg,#fff,#fff); 
    border-radius:12px;
    padding:12px;
    min-width:260px;
    box-sizing:border-box;
    box-shadow: 0 6px 22px rgba(16,24,40,0.04);
  }

  textarea, input[type="text"] {
    width:100%;
    background:transparent;
    color:var(--fg);
    border:1px dashed rgba(15,23,42,0.06);
    padding:12px;
    font-family: inherit;
    font-size:14px;
    resize:vertical;
    box-sizing:border-box;
    border-radius:8px;
  }

  button {
    background:transparent;
    color:var(--fg);
    border:0; padding:10px 12px; font-weight:700; cursor:pointer; letter-spacing:0.01em; display:inline-flex; align-items:center; gap:8px;
    border-radius:10px;
  }
  button.primary { color:white; background:linear-gradient(90deg,var(--accent-1),var(--accent-2)); box-shadow: 0 8px 18px rgba(255,107,107,0.14); }
  button.purple { color:white; background:linear-gradient(90deg,var(--accent-3),#a78bfa); box-shadow: 0 8px 18px rgba(124,58,237,0.12); }
  button.ghost { background:transparent; color:var(--muted); border:1px solid rgba(15,23,42,0.04); padding:8px 10px }
  button.warn { background: linear-gradient(90deg,#ff7a7a,#ffb86b); color:white }

  .kbd { background:linear-gradient(90deg,#fff,rgba(255,255,255,0.8)); border-radius:8px; padding:6px 10px; color:var(--muted); font-size:13px; border:1px solid rgba(15,23,42,0.04) }

  .trace { background: linear-gradient(180deg,#fff8f6,#fffdfb); color:var(--fg); border-radius:10px; padding:14px; font-size:14px; line-height:1.45; max-height:50vh; overflow:auto; white-space:pre-wrap; border:1px solid rgba(124,58,237,0.03) }

  .list { background:linear-gradient(180deg,#fff,#fff); border-radius:10px; border:1px solid rgba(15,23,42,0.04); padding:10px; font-size:14px; color:var(--fg) }

  .cmds { display:flex; gap:8px; flex-wrap:wrap; }

  .badge { background:linear-gradient(90deg,var(--accent-2),var(--accent-3)); color:white; padding:6px 10px; border-radius:999px; font-size:12px }

  /* decorative header strip */
  .header-strip{ height:8px; border-radius:10px; background: linear-gradient(90deg,var(--accent-1),var(--accent-3)); box-shadow: 0 6px 18px rgba(124,58,237,0.06) }

  /* Mobile */
  @media (max-width:900px){ #app{ flex-direction:column; padding:14px } .panel{ width:100% } }
</style>
</head>
<body>
  <div id="app">
    <div class="terminal" role="main" aria-label="Fault Diagnosis Terminal">
      <div class="header-strip" aria-hidden="true"></div>
      <div class="title">
        <h1>FAULT-DIAG — vibrant UI</h1>
        <div class="meta">Symbolic Diagnosis • forward/backward chaining • keyboard-first</div>
      </div>

      <div class="console" id="console">
        <div style="font-size:13px; color:var(--muted); margin-bottom:8px">Commands: <span class="kbd">forward</span>, <span class="kbd">backward &lt;GOAL&gt;</span>, <span class="kbd">list</span>, <span class="kbd">reset</span>. Use the editors to load a KB quickly.</div>

        <div style="display:flex; gap:12px; align-items:flex-start; margin-bottom:10px;">
          <div style="flex:1; min-width:0">
            <div style="font-size:13px; color:var(--muted); margin-bottom:6px">Knowledge Base (rules)</div>
            <div id="rulesView" class="list" contenteditable="false" aria-live="polite"></div>
          </div>

          <div style="width:260px">
            <div style="font-size:13px; color:var(--muted); margin-bottom:6px">Facts (observations)</div>
            <div id="factsView" class="list" contenteditable="false" aria-live="polite"></div>
          </div>
        </div>

        <div style="display:flex; gap:12px; align-items:flex-start;">
          <div style="flex:1; min-width:0">
            <div style="font-size:13px; color:var(--muted); margin-bottom:6px">Derivation Trace</div>
            <div id="trace" class="trace" role="log" aria-live="polite">No runs yet — use <span class="kbd">forward</span> or <span class="kbd">backward &lt;goal&gt;</span></div>
          </div>

          <div style="width:320px; display:flex; flex-direction:column; gap:8px;">
            <div style="font-size:13px; color:var(--muted);">Quick Add</div>
            <textarea id="rulesEditor" rows="6" placeholder="If A AND B -> C\nIf SensorX -> Alarm" spellcheck="false"></textarea>
            <textarea id="factsEditor" rows="4" placeholder="SensorA_Fails\nHigh_Load" spellcheck="false"></textarea>
            <div class="cmds">
              <button id="btnLoad" class="primary">LOAD</button>
              <button id="btnFwd" class="purple">FORWARD</button>
              <button id="btnBwd" class="ghost">BACKWARD</button>
              <button id="btnList" class="ghost">LIST</button>
              <button id="btnClear" class="ghost">CLEAR</button>
              <button id="btnExport" class="ghost">EXPORT</button>
            </div>
            <div style="font-size:12px; color:var(--muted); margin-top:6px">Tip: Put rules one-per-line. SHIFT+Enter for new lines.</div>
          </div>
        </div>

      </div>
    </div>

    <aside class="panel" role="complementary" aria-label="Controls">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px">
        <div style="font-weight:700; color:var(--accent-3)">Controls</div>
        <div class="badge">vibrant • warm</div>
      </div>

      <label style="font-size:13px; color:var(--muted); margin-bottom:6px">Backward Goal</label>
      <input id="goalInput" type="text" placeholder="e.g., Notify_Technician" />

      <div style="margin-top:10px; display:flex; gap:8px">
        <button id="btnWhy" class="primary" style="flex:1">JUSTIFY</button>
        <button id="btnExplain" class="ghost">EXPLAIN</button>
      </div>

      <div style="margin-top:12px">
        <div style="font-size:13px; color:var(--muted); margin-bottom:6px">Shortcuts</div>
        <div style="display:flex; gap:8px; flex-wrap:wrap">
          <div class="kbd">Ctrl + L</div>
          <div class="kbd">Ctrl + R</div>
          <div class="kbd">Enter (facts editor)</div>
        </div>
      </div>

      <div style="margin-top:14px">
        <div style="font-size:13px; color:var(--muted); margin-bottom:8px">Example KB</div>
        <button id="loadExample" class="ghost" style="width:100%">Load Example Rules</button>
      </div>

      <div style="margin-top:auto; font-size:12px; color:var(--muted)">
        <div style="margin-bottom:6px">Design: bright, friendly — helpful hints & larger tap targets.</div>
        <div style="color:var(--muted);">© FaultDiag • 2025</div>
      </div>
    </aside>
  </div>

<script>
/* The original logic is kept unchanged — forward/backward chaining */
(function(){
  // DOM
  const rulesView = document.getElementById('rulesView')
  const factsView = document.getElementById('factsView')
  const traceEl = document.getElementById('trace')
  const rulesEditor = document.getElementById('rulesEditor')
  const factsEditor = document.getElementById('factsEditor')
  const btnLoad = document.getElementById('btnLoad')
  const btnFwd = document.getElementById('btnFwd')
  const btnBwd = document.getElementById('btnBwd')
  const btnList = document.getElementById('btnList')
  const btnClear = document.getElementById('btnClear')
  const btnExport = document.getElementById('btnExport')
  const btnWhy = document.getElementById('btnWhy')
  const btnExplain = document.getElementById('btnExplain')
  const loadExample = document.getElementById('loadExample')
  const goalInput = document.getElementById('goalInput')

  // model
  let facts = []
  let rules = []
  let lastTrace = []

  // parser
  function parseRules(text){
    const lines = text.split('\n').map(l => l.trim()).filter(Boolean)
    const out = []
    for (const line of lines){
      const parts = line.split('->')
      if (parts.length !== 2) continue
      const lhs = parts[0].replace(/^If\s*/i,'').trim()
      const rhs = parts[1].trim()
      const ants = lhs.split(/\bAND\b/i).map(s => s.trim()).filter(Boolean)
      out.push({ antecedents: ants, consequent: rhs })
    }
    return out
  }

  // render functions
  function renderRules(){
    rulesView.innerText = ''
    if (!rules.length) { rulesView.innerText = '(no rules loaded)'; return }
    const lines = rules.map((r,idx) => `${idx+1}. IF ${r.antecedents.join(' AND ')} -> ${r.consequent}`)
    rulesView.innerText = lines.join('\n')
  }
  function renderFacts(){
    factsView.innerText = ''
    if (!facts.length) { factsView.innerText = '(no facts)'; return }
    factsView.innerText = facts.join('\n')
  }
  function setTrace(txt){
    lastTrace = Array.isArray(txt) ? txt : [txt]
    traceEl.innerText = lastTrace.join('\n')
    traceEl.scrollTop = traceEl.scrollHeight
  }

  // chaining engines
  function forwardChain(rulesList, factsList){
    const known = new Set(factsList)
    const trace = []
    let changed = true
    while (changed){
      changed = false
      for (const r of rulesList){
        if (known.has(r.consequent)) continue
        if (r.antecedents.every(a => known.has(a))){
          known.add(r.consequent)
          trace.push(`Derived ${r.consequent} <- ${r.antecedents.join(' AND ')}`)
          changed = true
        }
      }
    }
    return { known: Array.from(known), trace }
  }

  function backwardChain(rulesList, factsList, goal, visited = new Set()){
    if (factsList.includes(goal)) return { success:true, explanation: `${goal} is a fact` }
    if (visited.has(goal)) return { success:false }
    visited.add(goal)
    const applicable = rulesList.filter(r => r.consequent === goal)
    for (const r of applicable){
      const parts = []
      let all = true
      for (const a of r.antecedents){
        const res = backwardChain(rulesList, factsList, a, visited)
        if (!res.success){ all = false; break }
        parts.push(res.explanation)
      }
      if (all) return { success:true, explanation: `${goal} because ${parts.join(' ; ')}` }
    }
    return { success:false }
  }

  // commands
  function cmd_load(){
    const rtext = rulesEditor.value.trim()
    const ftext = factsEditor.value.trim()
    rules = parseRules(rtext)
    facts = ftext ? ftext.split('\n').map(s=>s.trim()).filter(Boolean) : []
    renderRules(); renderFacts()
    setTrace('KB loaded. Use FORWARD or BACKWARD to run inference.')
  }

  function cmd_forward(){
    if (!rules.length) { setTrace('No rules loaded.'); return }
    const res = forwardChain(rules, facts)
    renderFacts()
    setTrace(res.trace.length ? res.trace.join('\n') + '\n\nKnown: ' + res.known.join(', ') : 'No new facts derived.')
  }

  function cmd_backward(goal){
    if (!goal) { setTrace('No goal specified for backward chaining.'); return }
    const res = backwardChain(rules, facts, goal)
    setTrace(res.success ? `PROVED ${goal}:\n${res.explanation}` : `FAILED to prove ${goal}`)
  }

  function cmd_list(){
    renderRules(); renderFacts()
    setTrace('Listed rules and facts (see left).')
  }

  function cmd_clear(){
    facts = []; rules = []; lastTrace = []; renderRules(); renderFacts(); setTrace('Cleared KB and facts.')
  }

  function cmd_export(){
    const payload = { rulesText: rulesEditor.value, factsText: factsEditor.value }
    const blob = new Blob([JSON.stringify(payload, null, 2)], { type: 'application/json' })
    const url = URL.createObjectURL(blob)
    const a = document.createElement('a'); a.href = url; a.download = 'kb_export.json'; a.click(); URL.revokeObjectURL(url)
    setTrace('Exported KB to kb_export.json')
  }

  // button handlers
  btnLoad.addEventListener('click', cmd_load)
  btnFwd.addEventListener('click', cmd_forward)
  btnBwd.addEventListener('click', () => {
    const g = goalInput.value.trim() || prompt('Goal to justify?')
    if (!g) return
    cmd_backward(g)
  })
  btnList.addEventListener('click', cmd_list)
  btnClear.addEventListener('click', cmd_clear)
  btnExport.addEventListener('click', cmd_export)
  btnWhy.addEventListener('click', () => {
    const g = goalInput.value.trim() || prompt('Goal to justify?')
    if (!g) return
    cmd_backward(g)
  })
  btnExplain.addEventListener('click', cmd_forward)
  loadExample.addEventListener('click', () => {
    rulesEditor.value = `If SensorA_Fails -> Alarm\nIf High_Load AND Motor_Noise -> Motor_Fault\nIf Motor_Fault -> Reduce_Speed\nIf Alarm -> Notify_Technician`
    factsEditor.value = `SensorA_Fails\nHigh_Load\nMotor_Noise`
    cmd_load()
  })

  // keyboard shortcuts: Ctrl+L = load, Ctrl+R = run forward
  window.addEventListener('keydown', (e) => {
    if (e.ctrlKey && e.key.toLowerCase() === 'l'){ e.preventDefault(); cmd_load() }
    if (e.ctrlKey && e.key.toLowerCase() === 'r'){ e.preventDefault(); cmd_forward() }
    if (e.key === 'Enter' && document.activeElement === factsEditor){ e.preventDefault(); cmd_forward() }
  })

  // initialize with example
  loadExample.click()
})();
</script>
</body>
</html>

<!-- Additional features added below: keyboard focus outlines, inline rule validation, derived-fact labels, localStorage save/load, derivation graph (SVG) rendering, and accessible ARIA announcements. -->

